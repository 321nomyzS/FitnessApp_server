{% extends 'base.html' %}

{% block extra_head %}
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <!-- DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
    <style>
        /* Poprawienie szerokości kolumn */
        #exercise-table th,
        #exercise-table td {
            text-align: left;
            padding: 8px;
        }

        #exercise-table th:nth-child(1),
        #exercise-table td:nth-child(1) {
            width: 10%;
        }

        #exercise-table th:nth-child(2),
        #exercise-table td:nth-child(2) {
            width: 20%;
        }

        #exercise-table th:nth-child(3),
        #exercise-table td:nth-child(3) {
            width: 30%;
        }

        #exercise-table th:nth-child(4),
        #exercise-table td:nth-child(4) {
            width: 10%;
        }

        #exercise-table th:nth-child(5),
        #exercise-table td:nth-child(5) {
            width: 10%;
        }

        #exercise-table th:nth-child(6),
        #exercise-table td:nth-child(6) {
            width: 20%;
        }

        /* Poprawienie wyglądu przycisków akcji */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-buttons a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 30px;
        }
    </style>
{% endblock %}

{% block content %}
    <p class="font-medium text-gray-900 text-2xl mb-7">
        Pokaż ćwiczenia
    </p>

    <table class="w-full table-fixed" datatable id="exercise-table">
        <thead class="">
            <tr class="bg-white my-5">
                <th class="w-1/10 py-5 px-6 text-left text-gray-600 font-bold uppercase">ID</th>
                <th class="w-1/5 py-5 px-6 text-left text-gray-600 font-bold uppercase">Nazwa</th>
                <th class="w-1/3 py-5 px-6 text-left text-gray-600 font-bold uppercase">Krótki opis</th>
                <th class="w-1/10 py-5 px-6 text-left text-gray-600 font-bold uppercase">Typ</th>
                <th class="w-1/10 py-5 px-6 text-left text-gray-600 font-bold uppercase">Język</th>
                <th class="w-1/5 py-5 px-6 text-left text-gray-600 font-bold uppercase">Akcje</th>
            </tr>
        </thead>
        <tbody class="bg-white">
            {% for exercise in exercises %}
            <tr>
                <td class="py-5 w-2 border-b border-r border-gray-200">{{ exercise.id }}</td>
                <td class="py-5 px-6 border-b border-r border-gray-200">{{ exercise.title }}</td>
                <td class="py-5 px-6 border-b border-r border-gray-200">{{ exercise.short_description }}</td>
                <td class="py-5 px-6 border-b border-r border-gray-200">{{ exercise.type.type_name }}</td>
                <td class="py-5 px-6 border-b border-r border-gray-200">{{ exercise.language.language_name }}</td>
                <td class="py-5 px-6 border-b border-r border-gray-200">
                    <div class="action-buttons">
                        <a href="{% url 'show_exercise' id=exercise.id %}" class="bg-green-600 rounded-md text-sm hover:bg-green-800 text-white flex items-center justify-center">
{#=======#}
{#              </tr>#}
{#            </thead>#}
{#            <tbody class="bg-white">#}
{#              {% for exercise in exercises %}#}
{#              <tr>#}
{#                <td class="py-5 w-2 border-t border-r border-gray-200">{{ exercise.id }}</td>#}
{#                <td class="py-5 px-6 border-t border-r border-gray-200">{{ exercise.title }}</td>#}
{#                <td class="py-5 px-6 border-t border-r border-gray-200">{{ exercise.short_description }}</td>#}
{#                <td class="py-5 px-6 border-t border-r border-gray-200">{{ exercise.type.type_name }}</td>#}
{#                <td class="py-5 px-6 border-t border-r border-gray-200">{{ exercise.language.language_name }}</td>#}
{#                <td class="py-5 px-6 border-t border-gray-200 flex flex-row justify-around">#}
{#                    <a href="{% url 'show_exercise' id=exercise.id %}" class="bg-green-600 flex flex-row w-20 justify-around rounded-md text-sm hover:bg-green-800">#}
{#                        <p class="text-white my-auto">#}
{#>>>>>>> b1bf4fb28e8bbe700863eb687858cec4bfde52e8#}
                            Pokaż
                        </a>
                        <a href="{% url 'edit_exercise' id=exercise.id %}" class="bg-blue-500 rounded-md text-sm hover:bg-blue-700 text-white flex items-center justify-center">
                            Edytuj
                        </a>
                        <a href="#" onclick="confirmDelete({{ exercise.id }});" class="bg-red-700 rounded-md text-sm hover:bg-red-900 text-white flex items-center justify-center">
                            Usuń
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center font-normal leading-normal text-sm">Brak ćwiczeń</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready( function () {
            $('#exercise-table').DataTable({
                "paging": false,  // Wyłącza paginację
                "ordering": true,  // Włącza sortowanie
                "info": false,  // Wyłącza informacje o stronach
                "searching": false  // Wyłącza pasek wyszukiwania
            });
        });

        function confirmDelete(id) {
            const token = '{{ csrf_token }}'; // Zapewnia dostępność tokena CSRF
            if (confirm("Czy na pewno chcesz usunąć to ćwiczenie?")) {
                fetch(`{% url 'delete_exercise' id=999 %}`.replace('999', id), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': token
                    }
                }).then(response => {
                    if (response.ok) {
                        window.location.reload(); // Odśwież stronę po udanym usunięciu
                    } else {
                        alert('Nie udało się usunąć ćwiczenia.');
                    }
                });
            }
        }
    </script>
{% endblock %}
